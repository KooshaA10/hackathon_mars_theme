{% extends "base.html" %}
{% block title %}Food Diary{% endblock %}
{% block content %}
<h1>My Food Diary</h1>

<!-- Tabs -->
<div class="tabs">
  {% for meal in ['Breakfast', 'Lunch', 'Dinner', 'Snack'] %}
    <button class="{% if loop.first %}active{% endif %}" onclick="openMeal('{{ meal.lower() }}', this)">{{ meal }}</button>
  {% endfor %}
</div>

<!-- Tab content -->
<div class="tab-content">
  {% for meal in ['Breakfast', 'Lunch', 'Dinner', 'Snack'] %}
  <div id="{{ meal.lower() }}" class="{% if loop.first %}active{% endif %}">

    <!-- Add food form -->
    <form method="post" action="{{ url_for('main.add_food', meal_name=meal.lower()) }}">
      <select name="food_id" required>
        {% for f in foods %}
          <option value="{{ f.id }}">{{ f.name }} — {{ f.calories }} kcal</option>
        {% endfor %}
      </select>
      <input type="number" name="quantity" min="1" placeholder="Qty (g/ml)" required>
      <button type="submit">Add</button>
    </form>

    <!-- Foods already added -->
    <ul>
      {% for entry in diary[meal.lower()] %}
        <li>{{ entry.food.name }} — {{ entry.quantity }} g ({{ entry.food.calories }} kcal)</li>
      {% endfor %}
      {% if diary[meal.lower()]|length == 0 %}
        <li><em>No foods added yet.</em></li>
      {% endif %}
    </ul>

  </div>
  {% endfor %}
</div>

<script>
function openMeal(mealId, btn) {
  document.querySelectorAll('.tab-content > div').forEach(div => div.classList.remove('active'));
  document.querySelectorAll('.tabs button').forEach(b => b.classList.remove('active'));
  document.getElementById(mealId).classList.add('active');
  btn.classList.add('active');
}
</script>
{% endblock %}